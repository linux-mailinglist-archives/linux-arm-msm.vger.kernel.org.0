Return-Path: <linux-arm-msm+bounces-83115-lists+linux-arm-msm=lfdr.de@vger.kernel.org>
X-Original-To: lists+linux-arm-msm@lfdr.de
Delivered-To: lists+linux-arm-msm@lfdr.de
Received: from dfw.mirrors.kernel.org (dfw.mirrors.kernel.org [142.0.200.124])
	by mail.lfdr.de (Postfix) with ESMTPS id A12FBC81F7E
	for <lists+linux-arm-msm@lfdr.de>; Mon, 24 Nov 2025 18:48:03 +0100 (CET)
Received: from smtp.subspace.kernel.org (relay.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-ECDSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by dfw.mirrors.kernel.org (Postfix) with ESMTPS id 979E04E5450
	for <lists+linux-arm-msm@lfdr.de>; Mon, 24 Nov 2025 17:47:57 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 854232BEFEF;
	Mon, 24 Nov 2025 17:47:56 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b="Oa39+khr"
X-Original-To: linux-arm-msm@vger.kernel.org
Received: from smtp.kernel.org (aws-us-west-2-korg-mail-1.web.codeaurora.org [10.30.226.201])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 5A30A2C11D5
	for <linux-arm-msm@vger.kernel.org>; Mon, 24 Nov 2025 17:47:55 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=10.30.226.201
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1764006476; cv=none; b=nDny60KAr0R53FYdrqa1uf0GPNr/VEmeaHSMW0juihmFPlrDzvumXUrOrtiIwzyBvhvh+dOpqv3bsqUxG11LLJ0VPStosizvnrNEXjzl/Tzl8zXeBydGJS7M3CfRMYOCOV4h+gn2nCMAAMGiH9QG0cV2rjf4PlSkF7h9B+t1IJo=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1764006476; c=relaxed/simple;
	bh=u9LC0QOwKIPGbGzJvcRIjbKTr5QDS5OcptRArSq5Rbk=;
	h=Date:Message-ID:From:To:Cc:Subject:In-Reply-To:References:
	 MIME-Version:Content-Type; b=kZylznqmbYn9g4Lc85pWfPLMDDbv0LhDqDd8bZg2BTauEezT+9dQmOtCaj24SdmpX8COOf676RPy4FySqVQj1vCmG6L57MktKnzg/e0VMHER15/la2e2V4x/DXyfJxQi4iwK5KlVm00RYXRbuc3X9asguox9N+FeVROzM+HgW8I=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b=Oa39+khr; arc=none smtp.client-ip=10.30.226.201
Received: by smtp.kernel.org (Postfix) with ESMTPSA id C0FA6C116C6;
	Mon, 24 Nov 2025 17:47:55 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
	s=k20201202; t=1764006475;
	bh=u9LC0QOwKIPGbGzJvcRIjbKTr5QDS5OcptRArSq5Rbk=;
	h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
	b=Oa39+khr+k7qNyexcw/Yh5q/y8sX0e6so7K39AWgPDLw7Ju0zEZdfzcYXGAVEowU0
	 t2Eg6aWfbDAxYGEUvFzs5JUEa+u4ukSkyVoidlT6gN3qId+2I0tnLACIzlV10Otlj8
	 9hTeG/lOEVuKcTgU4lhgY3een7CP9cWPcoh+/DhLmtPAV1pQmzahMlXhpim9biqU0U
	 mIy7bmkHYi16snt3SBxs8Ro3JG48gnvCOuPjev9DS5piVgHiFn+mIsE7WLio3pSG8t
	 TK8wUvwgh/I9gtyqpcUGjbGrRiRV7LzGIDWpYAyjG+1IKai3qF87g9/x9MnOiwu7D/
	 F/ZXwRRf7vOVA==
Received: from sofa.misterjones.org ([185.219.108.64] helo=goblin-girl.misterjones.org)
	by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
	(Exim 4.98.2)
	(envelope-from <maz@kernel.org>)
	id 1vNafJ-00000007vfW-1mz0;
	Mon, 24 Nov 2025 17:47:53 +0000
Date: Mon, 24 Nov 2025 17:47:53 +0000
Message-ID: <86ikezqq46.wl-maz@kernel.org>
From: Marc Zyngier <maz@kernel.org>
To: Vladimir Zapolskiy <vladimir.zapolskiy@linaro.org>
Cc: Catalin Marinas <catalin.marinas@arm.com>,
	Will Deacon <will@kernel.org>,
	Mark Brown <broonie@kernel.org>,
	linux-arm-kernel@lists.infradead.org,
	linux-arm-msm@vger.kernel.org
Subject: Re: [PATCH] arm64: cpufeature: Unrestrict ID_AA64MMFR1_EL1 bit assignments
In-Reply-To: <20251124162955.3616314-1-vladimir.zapolskiy@linaro.org>
References: <20251124162955.3616314-1-vladimir.zapolskiy@linaro.org>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/30.1
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
Precedence: bulk
X-Mailing-List: linux-arm-msm@vger.kernel.org
List-Id: <linux-arm-msm.vger.kernel.org>
List-Subscribe: <mailto:linux-arm-msm+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-arm-msm+unsubscribe@vger.kernel.org>
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: vladimir.zapolskiy@linaro.org, catalin.marinas@arm.com, will@kernel.org, broonie@kernel.org, linux-arm-kernel@lists.infradead.org, linux-arm-msm@vger.kernel.org
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false

On Mon, 24 Nov 2025 16:29:55 +0000,
Vladimir Zapolskiy <vladimir.zapolskiy@linaro.org> wrote:
> 
> It appears that 4 out of 8 Qualcomm SM8450 SoC cores do not generate
> an SError interrupt due to an External abort on a speculative read,
> and it is reported as a failed sanity check on boot:
> 
>     CPU features: SANITY CHECK: Unexpected variation in SYS_ID_AA64MMFR1_EL1. Boot CPU: 0x00000011212122, CPU4: 0x00000010212122
>     CPU features: SANITY CHECK: Unexpected variation in SYS_ID_AA64MMFR1_EL1. Boot CPU: 0x00000011212122, CPU5: 0x0000001021212
>     CPU features: SANITY CHECK: Unexpected variation in SYS_ID_AA64MMFR1_EL1. Boot CPU: 0x00000011212122, CPU6: 0x00000010212122
>     CPU features: SANITY CHECK: Unexpected variation in SYS_ID_AA64MMFR1_EL1. Boot CPU: 0x00000011212122, CPU7: 0x00000010212122
> 
> Due to the failed sanity check the kernel is marked as tainted in runtime:
> 
>     Tainted: [S]=CPU_OUT_OF_SPEC
> 
> Unrestrict the ID_AA64MMFR1_EL1 SpecSEI bits, since apparently it's
> a supported option at least on this heterogeneous SoC.

Supporting asymmetric configurations has always been on the basis of
having the same feature set. Just because some SoCs ignore this
requirement doesn't make it acceptable.

Tainting the kernel is the right thing to do IMO, because that's an
unexpected difference.

Additionally, making things non-strict may open a gaping hole in the
virtualisation support. All you would need to do is boot on the CPUs
that do not have SpecSEI, and bring up the CPUs that do have SpecSEI
late, *after* you have started a VM. That VM will have been told that
it cannot get a speculative SError, and yet will be able to run on
CPUs that do.

Thanks,

	M.

-- 
Without deviation from the norm, progress is not possible.

